#ifndef NTC_H
#define NTC_H

#include "module.h"

typedef enum {
        NTC_COIL_0,
        NTC_COIL_1,
        NTC_MOS,
} ntc_e;

typedef enum {
        NTC_TYPE_PT5_25E2,
        NTC_TYPE_NCP15XV103J03RC,
        NTC_TYPE_MAX,
} ntc_type_e;

typedef struct {
        const f32 *data;
        u32        len;
} ntc_table_t;

static const f32 g_ntc_pt5_25e2[] = {
    // -50 ~ -10
    K(6771.0f),
    K(6306.0f),
    K(5875.0f),
    K(5477.0f),
    K(5109.0f),
    K(4767.0f),
    K(4451.0f),
    K(4158.0f),
    K(3886.0f),
    K(3399.0f),
    K(3181.0f),
    K(2978.0f),
    K(2790.0f),
    K(2614.0f),
    K(2451.0f),
    K(2299.0f),
    K(2158.0f),
    K(2026.0f),
    K(1902.0f),
    K(1788.0f),
    K(1680.0f),
    K(1580.0f),
    K(1487.0f),
    K(1399.0f),
    K(1317.0f),
    K(1241.0f),
    K(1169.0f),
    K(1102.0f),
    K(1039.0f),
    K(980.5f),
    K(925.4f),
    K(873.6f),
    K(825.1f),
    K(779.5f),
    K(736.8f),
    K(696.6f),
    K(658.9f),
    K(623.4f),
    K(590.0f),
    K(558.6f),

    // -10 ~ 30
    K(558.6f),
    K(529.1f),
    K(501.3f),
    K(475.1f),
    K(450.4f),
    K(427.2f),
    K(405.3f),
    K(384.6f),
    K(365.1f),
    K(346.8f),
    K(329.4f),
    K(312.7f),
    K(297.0f),
    K(282.2f),
    K(268.2f),
    K(255.0f),
    K(242.5f),
    K(230.6f),
    K(219.5f),
    K(208.9f),
    K(198.9f),
    K(189.4f),
    K(180.5f),
    K(172.0f),
    K(163.9f),
    K(156.3f),
    K(149.1f),
    K(142.3f),
    K(135.8f),
    K(129.6f),
    K(123.7f),
    K(118.2f),
    K(112.9f),
    K(107.9f),
    K(103.2f),
    K(98.63f),
    K(94.33f),
    K(90.24f),
    K(86.35f),
    K(82.65f),
    K(79.12f),

    // 30 ~ 70
    K(79.12f),
    K(75.77f),
    K(72.58f),
    K(69.53f),
    K(66.63f),
    K(63.87f),
    K(61.24f),
    K(58.73f),
    K(56.33f),
    K(54.05f),
    K(51.87f),
    K(49.79f),
    K(47.80f),
    K(45.91f),
    K(44.09f),
    K(42.36f),
    K(40.71f),
    K(39.13f),
    K(37.62f),
    K(36.17f),
    K(34.79f),
    K(33.47f),
    K(32.20f),
    K(30.99f),
    K(29.83f),
    K(28.72f),
    K(27.66f),
    K(26.64f),
    K(25.66f),
    K(24.73f),
    K(23.83f),
    K(22.97f),
    K(22.15f),
    K(21.35f),
    K(20.60f),
    K(19.87f),
    K(19.17f),
    K(18.50f),
    K(17.86f),
    K(17.24f),
    K(16.64f),

    // 70 ~ 110
    K(16.64f),
    K(16.07f),
    K(15.52f),
    K(15.00f),
    K(14.49f),
    K(14.00f),
    K(13.54f),
    K(13.09f),
    K(12.65f),
    K(12.24f),
    K(11.83f),
    K(11.45f),
    K(11.08f),
    K(10.72f),
    K(10.37f),
    K(10.04f),
    K(9.722f),
    K(9.414f),
    K(9.117f),
    K(8.831f),
    K(8.556f),
    K(8.290f),
    K(8.033f),
    K(7.786f),
    K(7.547f),
    K(7.317f),
    K(7.095f),
    K(6.881f),
    K(6.674f),
    K(6.474f),
    K(6.282f),
    K(6.095f),
    K(5.916f),
    K(5.742f),
    K(5.574f),
    K(5.412f),
    K(5.255f),
    K(5.104f),
    K(4.957f),
    K(4.816f),
    K(4.679f),

    // 110 ~ 150
    K(4.679f),
    K(4.546f),
    K(4.418f),
    K(4.294f),
    K(4.174f),
    K(4.058f),
    K(3.946f),
    K(3.837f),
    K(3.732f),
    K(3.630f),
    K(3.532f),
    K(3.436f),
    K(3.344f),
    K(3.254f),
    K(3.167f),
    K(3.083f),
    K(3.002f),
    K(2.922f),
    K(2.846f),
    K(2.772f),
    K(2.700f),
    K(2.630f),
    K(2.562f),
    K(2.496f),
    K(2.432f),
    K(2.371f),
    K(2.311f),
    K(2.252f),
    K(2.196f),
    K(2.141f),
    K(2.088f),
    K(2.036f),
    K(1.986f),
    K(1.937f),
    K(1.890f),
    K(1.844f),
    K(1.799f),
    K(1.755f),
    K(1.713f),
    K(1.672f),
    K(1.632f),

    // 150 ~ 190
    K(1.632f),
    K(1.594f),
    K(1.556f),
    K(1.519f),
    K(1.484f),
    K(1.449f),
    K(1.415f),
    K(1.382f),
    K(1.351f),
    K(1.320f),
    K(1.289f),
    K(1.260f),
    K(1.231f),
    K(1.204f),
    K(1.177f),
    K(1.150f),
    K(1.125f),
    K(1.100f),
    K(1.075f),
    K(1.052f),
    K(1.028f),
    K(1.006f),
    K(0.9841f),
    K(0.9627f),
    K(0.9419f),
    K(0.9217f),
    K(0.9019f),
    K(0.8827f),
    K(0.8639f),
    K(0.8456f),
    K(0.8278f),
    K(0.8104f),
    K(0.7934f),
    K(0.7769f),
    K(0.7608f),
    K(0.7451f),
    K(0.7297f),
    K(0.7148f),
    K(0.7002f),
    K(0.6859f),
    K(0.6720f),

    // 190 ~ 230
    K(0.6720f),
    K(0.6584f),
    K(0.6452f),
    K(0.6323f),
    K(0.6197f),
    K(0.6073f),
    K(0.5953f),
    K(0.5836f),
    K(0.5721f),
    K(0.5609f),
    K(0.5500f),
    K(0.5393f),
    K(0.5289f),
    K(0.5187f),
    K(0.5087f),
    K(0.4990f),
    K(0.4895f),
    K(0.4802f),
    K(0.4711f),
    K(0.4622f),
    K(0.4536f),
    K(0.4451f),
    K(0.4368f),
    K(0.4287f),
    K(0.4208f),
    K(0.4130f),
    K(0.4054f),
    K(0.3980f),
    K(0.3908f),
    K(0.3837f),
    K(0.3768f),
    K(0.3700f),
    K(0.3633f),
    K(0.3568f),
    K(0.3505f),
    K(0.3443f),
    K(0.3382f),
    K(0.3322f),
    K(0.3264f),
    K(0.3207f),
    K(0.3151f),

    // 230 ~ 270
    K(0.3151f),
    K(0.3096f),
    K(0.3043f),
    K(0.2990f),
    K(0.2939f),
    K(0.2889f),
    K(0.2840f),
    K(0.2791f),
    K(0.2744f),
    K(0.2698f),
    K(0.2653f),
    K(0.2608f),
    K(0.2565f),
    K(0.2522f),
    K(0.2480f),
    K(0.2439f),
    K(0.2399f),
    K(0.2360f),
    K(0.2322f),
    K(0.2284f),
    K(0.2247f),
    K(0.2211f),
    K(0.2175f),
    K(0.2140f),
    K(0.2106f),
    K(0.2072f),
    K(0.2040f),
    K(0.2007f),
    K(0.1976f),
    K(0.1945f),
    K(0.1914f),
    K(0.1884f),
    K(0.1855f),
    K(0.1826f),
    K(0.1798f),
    K(0.1771f),
    K(0.1744f),
    K(0.1717f),
    K(0.1691f),
    K(0.1665f),
    K(0.1640f),

    // 270 ~ 300
    K(0.1640f),
    K(0.1615f),
    K(0.1591f),
    K(0.1567f),
    K(0.1544f),
    K(0.1521f),
    K(0.1499f),
    K(0.1476f),
    K(0.1455f),
    K(0.1433f),
    K(0.1412f),
    K(0.1392f),
    K(0.1372f),
    K(0.1352f),
    K(0.1332f),
    K(0.1313f),
    K(0.1295f),
    K(0.1276f),
    K(0.1258f),
    K(0.1240f),
    K(0.1223f),
    K(0.1205f),
    K(0.1189f),
    K(0.1172f),
    K(0.1156f),
    K(0.1140f),
    K(0.1124f),
    K(0.1108f),
    K(0.1093f),
    K(0.1078f),
    K(0.1063f),
};

static const f32 g_ntc_ncp15xv103j03rc[] = {
    K(328.996), K(237.387), K(173.185), K(127.773), K(95.327), K(71.746), K(54.564), K(41.813), K(32.330),
    K(25.194),  K(19.785),  K(15.651),  K(12.468),  K(10.000), K(8.072),  K(6.556),  K(5.356),  K(4.401),
    K(3.635),   K(3.019),   K(2.521),   K(2.115),   K(1.781),  K(1.509),  K(1.284),  K(1.097),  K(0.941),
    K(0.810),   K(0.701),   K(0.608),   K(0.530),   K(0.463),  K(0.406),  K(0.358),
};

static const ntc_table_t g_ntc_table[] = {
    [NTC_TYPE_PT5_25E2] =
        {
            .data = g_ntc_pt5_25e2,
            .len  = ARRAY_LEN(g_ntc_pt5_25e2),
        },
    [NTC_TYPE_NCP15XV103J03RC] =
        {
            .data = g_ntc_ncp15xv103j03rc,
            .len  = ARRAY_LEN(g_ntc_ncp15xv103j03rc),
        },
};

typedef struct {
        ntc_type_e         type;         // NTC型号
        f32                v_gnd;        // 上拉电阻 (Ω)，通常为10kΩ
        u32                adc_full_cnt; // ADC满量程计数值
        f32                min;          // 温度表最小值 (°C)
        f32                max;          // 温度表最大值 (°C)
        f32                step;         // 温度步进 (°C)
        const ntc_table_t *table;        // 电阻值表 (Ω)
} ntc_t;

f32 ntc_get_temp(ntc_t *ntc, i32 adc_raw);

#endif // !NTC_H
